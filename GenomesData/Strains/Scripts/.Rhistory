library(tidyverse)
ani <- read_tsv("Output_tables/ani_summary.tsv")
getwd()
ani <- read_tsv("../Output_tables/ani_summary.tsv")
ani
ani$name1[1000]
x <- ani$name1[1000]
str_split(x, "[0-9]_")
str_split(x, "[0-9.*]_")
str_split(x, "[0-9].*_")
str_split(x, "[0-9]+_")
str_split(x, "[0-9]+_")[3]
str_split(x, "[0-9]+_")[1][3]
str_split(x, "[0-9]+_")[[1]][3]
str_split(x, "[0-9]+_")
str_split(x, "[0-9]_")
str_split(x, "[0-9+]_")[[1]][3]
str_split(x, "[0-9+]_")
str_split(x, "[0-9][0-9]_")
str_split(x, "[0-9]_")
extract_envID <- function(x){
if(str_detect(x, "PH2017")){
#out <- str_split(x, "_")[[1]][3]
out <- str_split(x, "[0-9]_")[[1]][3]
} else {
out <- str_split(x, "_")[[1]][2]
}
#if(str_detect(x, "PH2015")){
#  out <- str_split(x, "_")[[1]][2]
#}
}
ani <- read_tsv("../Output_tables/ani_summary.tsv") %>%
mutate(name1_acronym= do.call(rbind, map(ani$name1, extract_envID)),
name2_acronym= do.call(rbind, map(ani$name2, extract_envID))) %>%
mutate(envID1= str_replace(name1, "_A|_B$", ""),
envID2= str_replace(name2, "_A|_B$", ""),
compID= str_c(envID1, envID2, sep= "-"))
dir_input <- file.path("/Users","kbg","Documents","UC_Berkeley","CyanoMeta_NSF","Metagenomics", "Microcoleus_Analysis","EnvData")
env <- read_tsv(file.path(dir_input, "env_data_formated.tsv"))
env$biotite_ID
str_split(env$biotite_ID, "[0-9]_")[[1]][3]
str_split(env$biotite_ID, "[0-9]_")
map(env$biotite_ID, function(x) str_split(x, "[0-9]_")[[1]][3])
do.call(rbind, map(env$biotite_ID, function(x) str_split(x, "[0-9]_")[[1]][3]))
ani <- read_tsv("../Output_tables/ani_summary.tsv") %>%
mutate(name1_acronym= do.call(rbind, map(ani$name1, extract_envID)),
name2_acronym= do.call(rbind, map(ani$name2, extract_envID))) %>%
mutate(envID1= str_replace(name1, "_A|_B$", ""),
envID2= str_replace(name2, "_A|_B$", ""),
compID= str_c(envID1, envID2, sep= "-"))
View(ani)
ani <- read_tsv("../Output_tables/ani_summary.tsv") %>%
#mutate(name1_acronym= do.call(rbind, map(ani$name1, extract_envID)),
#       name2_acronym= do.call(rbind, map(ani$name2, extract_envID))) %>%
# mutate(envID1= str_replace(name1, "_A|_B$", ""),
#        envID2= str_replace(name2, "_A|_B$", ""),
#        compID= str_c(envID1, envID2, sep= "-"))
mutate(envID1= do.call(rbind, map(ani$name1, extract_envID)),
envID2= do.call(rbind, map(ani$name1, extract_envID)),
compID= str_c(envID1, envID2, sep= "-"))
View(ani)
ani <- read_tsv("../Output_tables/ani_summary.tsv") %>%
#mutate(name1_acronym= do.call(rbind, map(ani$name1, extract_envID)),
#       name2_acronym= do.call(rbind, map(ani$name2, extract_envID))) %>%
# mutate(envID1= str_replace(name1, "_A|_B$", ""),
#        envID2= str_replace(name2, "_A|_B$", ""),
#        compID= str_c(envID1, envID2, sep= "-"))
mutate(envID1= do.call(rbind, map(ani$name1, extract_envID)),
envID2= do.call(rbind, map(ani$name2, extract_envID)),
compID= str_c(envID1, envID2, sep= "-"))
View(ani)
str_split(x, "[0-9]_")[[1]][3]
str_replace(str_split(x, "[0-9]_")[[1]][3], "_A", "")
extract_envID <- function(x){
if(str_detect(x, "PH2017")){
#out <- str_split(x, "_")[[1]][3]
out <- str_replace(str_split(x, "[0-9]_")[[1]][3], "_A", "")
} else {
out <- str_split(x, "_")[[1]][2]
}
#if(str_detect(x, "PH2015")){
#  out <- str_split(x, "_")[[1]][2]
#}
}
ani <- read_tsv("../Output_tables/ani_summary.tsv") %>%
#mutate(name1_acronym= do.call(rbind, map(ani$name1, extract_envID)),
#       name2_acronym= do.call(rbind, map(ani$name2, extract_envID))) %>%
# mutate(envID1= str_replace(name1, "_A|_B$", ""),
#        envID2= str_replace(name2, "_A|_B$", ""),
#        compID= str_c(envID1, envID2, sep= "-"))
mutate(envID1= do.call(rbind, map(ani$name1, extract_envID)),
envID2= do.call(rbind, map(ani$name2, extract_envID)),
compID= str_c(envID1, envID2, sep= "-"))
tenv <- env %>%
slice(-1) %>%
select(biotite_ID, temp, pH, mean_vX, TDP_ugL, NO3_ugL, NH4_ugL, DOC_ugL, TDN_ugL, NP, canopy_cover_percent, cond_ms) %>%
arrange(biotite_ID) %>%
#mutate(envID= str_replace(tenv$biotite_ID, "_A$", "")) %>%
mutate(envID= do.call(rbind, map(env$biotite_ID, function(x) str_replace(str_split(x, "[0-9]_")[[1]][3], "_A", "")))) %>%
select(biotite_ID, envID, everything())
tenv <- env %>%
slice(-1) %>%
select(biotite_ID, temp, pH, mean_vX, TDP_ugL, NO3_ugL, NH4_ugL, DOC_ugL, TDN_ugL, NP, canopy_cover_percent, cond_ms) %>%
arrange(biotite_ID) %>%
#mutate(envID= str_replace(tenv$biotite_ID, "_A$", "")) %>%
mutate(envID= do.call(rbind, map(biotite_ID, function(x) str_replace(str_split(x, "[0-9]_")[[1]][3], "_A", "")))) %>%
select(biotite_ID, envID, everything())
View(tenv)
calc_diffs <- function(vec){
df <- as_tibble(outer(vec, vec, `-`))
colnames(df) <- tenv$envID
df$envID1 <- tenv$envID
# df.l <- pivot_longer(df, names_to= "name2", values_to = colname, contains("PH")) %>%
#   mutate(compID= str_c(name1, name2, sep= "-"))
#
df.l <- pivot_longer(df, names_to= "envID2", values_to = "diff", contains("PH")) %>%
mutate(compID= str_c(envID1, envID2, sep= "-"),
diff= abs(diff))
}
comp_df <- map(tenv[, c(3:13)], calc_diffs) %>%
bind_rows(., .id="metric")
tenv[, c(3:13)]
calc_diffs <- function(vec){
df <- as_tibble(outer(vec, vec, `-`))
colnames(df) <- tenv$envID
df$envID1 <- tenv$envID
# df.l <- pivot_longer(df, names_to= "name2", values_to = colname, contains("PH")) %>%
#   mutate(compID= str_c(name1, name2, sep= "-"))
#
df.l <- pivot_longer(df, names_to= "envID2", values_to = "diff", contains("PH")) %>%
mutate(compID= str_c(envID1, envID2, sep= "-"),
diff= abs(diff))
}
View(tenv)
df=tenv
vec= env$temp
df <- as_tibble(outer(vec, vec, `-`))
colnames(df) <- tenv$envID
df$envID1 <- tenv$envID
vec= tenv$temp
df <- as_tibble(outer(vec, vec, `-`))
colnames(df) <- tenv$envID
df$envID1 <- tenv$envID
# df.l <- pivot_longer(df, names_to= "name2", values_to = colname, contains("PH")) %>%
#   mutate(compID= str_c(name1, name2, sep= "-"))
#
df.l <- pivot_longer(df, names_to= "envID2", values_to = "diff", contains("PH")) %>%
mutate(compID= str_c(envID1, envID2, sep= "-"),
diff= abs(diff))
df
# df.l <- pivot_longer(df, names_to= "name2", values_to = colname, contains("PH")) %>%
#   mutate(compID= str_c(name1, name2, sep= "-"))
#
df.l <- pivot_longer(df, names_to= "envID2", values_to = "diff", -envID1) %>%
mutate(compID= str_c(envID1, envID2, sep= "-"),
diff= abs(diff))
df.l
df
tenv
tenv <- env %>%
slice(-1) %>%
select(biotite_ID, temp, pH, mean_vX, TDP_ugL, NO3_ugL, NH4_ugL, DOC_ugL, TDN_ugL, NP, canopy_cover_percent, cond_ms) %>%
arrange(biotite_ID) %>%
#mutate(envID= str_replace(tenv$biotite_ID, "_A$", "")) %>%
mutate(envID= do.call(rbind, map(biotite_ID, function(x) str_replace(str_split(x, "[0-9]_")[[1]][3], "_A", "")))) %>%
select(biotite_ID, envID, everything())
tenv
env
do.call(rbind, map(biotite_ID, function(x) str_replace(str_split(x, "[0-9]_")[[1]][3], "_A", "")))
do.call(rbind, map(tenv$biotite_ID, function(x) str_replace(str_split(x, "[0-9]_")[[1]][3], "_A", "")))
pull(do.call(rbind, map(tenv$biotite_ID, function(x) str_replace(str_split(x, "[0-9]_")[[1]][3], "_A", "")))))
pull(do.call(rbind, map(tenv$biotite_ID, function(x) str_replace(str_split(x, "[0-9]_")[[1]][3], "_A", ""))))
tenv
tenv <- env %>%
slice(-1) %>%
select(biotite_ID, temp, pH, mean_vX, TDP_ugL, NO3_ugL, NH4_ugL, DOC_ugL, TDN_ugL, NP, canopy_cover_percent, cond_ms) %>%
arrange(biotite_ID) %>%
#mutate(envID= str_replace(tenv$biotite_ID, "_A$", "")) %>%
mutate(envID= do.call(rbind, map(tenv$biotite_ID, function(x) str_replace(str_split(x, "[0-9]_")[[1]][3], "_A", "")))) %>%
rename(envID= `envID[, 1]`) %>%
select(biotite_ID, envID, everything())
do.call(rbind, map(tenv$biotite_ID, function(x) str_replace(str_split(x, "[0-9]_")[[1]][3], "_A", "")))[, 1]
tenv <- env %>%
slice(-1) %>%
select(biotite_ID, temp, pH, mean_vX, TDP_ugL, NO3_ugL, NH4_ugL, DOC_ugL, TDN_ugL, NP, canopy_cover_percent, cond_ms) %>%
arrange(biotite_ID) %>%
#mutate(envID= str_replace(tenv$biotite_ID, "_A$", "")) %>%
mutate(envID= do.call(rbind, map(tenv$biotite_ID, function(x) str_replace(str_split(x, "[0-9]_")[[1]][3], "_A", "")))[, 1]) %>%
#rename(envID= `envID[, 1]`) %>%
select(biotite_ID, envID, everything())
tenv
calc_diffs <- function(vec){
df <- as_tibble(outer(vec, vec, `-`))
colnames(df) <- tenv$envID
df$envID1 <- tenv$envID
# df.l <- pivot_longer(df, names_to= "name2", values_to = colname, contains("PH")) %>%
#   mutate(compID= str_c(name1, name2, sep= "-"))
#
df.l <- pivot_longer(df, names_to= "envID2", values_to = "diff", -envID1) %>%
mutate(compID= str_c(envID1, envID2, sep= "-"),
diff= abs(diff))
}
comp_df <- map(tenv[, c(3:13)], calc_diffs) %>%
bind_rows(., .id="metric")
comp_df
library(ggplot2)
ani.env <- left_join(ani, comp_df)
comp_df
ani$compID
head(ani$compID)
tail(ani$compID)
tail(comp_df$compID)
extract_envID <- function(x){
if(str_detect(x, "PH2017")){
#out <- str_split(x, "_")[[1]][3]
out <- str_replace(str_split(x, "[0-9]_")[[1]][3], "_A|_B", "")
} else {
out <- str_split(x, "_")[[1]][2]
}
#if(str_detect(x, "PH2015")){
#  out <- str_split(x, "_")[[1]][2]
#}
}
ani <- read_tsv("../Output_tables/ani_summary.tsv") %>%
#mutate(name1_acronym= do.call(rbind, map(ani$name1, extract_envID)),
#       name2_acronym= do.call(rbind, map(ani$name2, extract_envID))) %>%
# mutate(envID1= str_replace(name1, "_A|_B$", ""),
#        envID2= str_replace(name2, "_A|_B$", ""),
#        compID= str_c(envID1, envID2, sep= "-"))
mutate(envID1= do.call(rbind, map(ani$name1, extract_envID)),
envID2= do.call(rbind, map(ani$name2, extract_envID)),
compID= str_c(envID1, envID2, sep= "-"))
ani.env <- left_join(ani, comp_df)
tail(ani$compID)
tail(comp_df$compID)
tail(ani$envID1)
tail(comp_df$envID2)
ani <- read_tsv("../Output_tables/ani_summary.tsv") %>%
#mutate(name1_acronym= do.call(rbind, map(ani$name1, extract_envID)),
#       name2_acronym= do.call(rbind, map(ani$name2, extract_envID))) %>%
# mutate(envID1= str_replace(name1, "_A|_B$", ""),
#        envID2= str_replace(name2, "_A|_B$", ""),
#        compID= str_c(envID1, envID2, sep= "-"))
mutate(envID1= do.call(rbind, map(ani$name1, extract_envID))[, 1],
envID2= do.call(rbind, map(ani$name2, extract_envID))[, 1],
compID= str_c(envID1, envID2, sep= "-"))
tail(ani$envID1)
tail(comp_df$envID2)
ani.env <- left_join(ani, comp_df)
filter(ani.env, envID1 != envID2)
ggplot(filter(ani.env, envID1 != envID2), aes(x= diff, y= mean_conANI)) +
geom_point() +
geom_smooth(method= "lm") +
facet_wrap(~metric, nrow= 4, scales= "free_x") +
theme_bw()
ggplot(ani.env, aes(x= diff, y= mean_conANI)) +
geom_point() +
geom_smooth(method= "lm") +
facet_wrap(~metric, nrow= 4, scales= "free_x") +
theme_bw()
ggplot(ani.env, aes(x= diff, y= mean_popANI)) +
geom_point() +
geom_smooth(method= "lm") +
facet_wrap(~metric, nrow= 4, scales= "free_x") +
theme_bw()
ggplot(filter(ani.env, diff > 0), aes(x= diff, y= mean_popANI)) +
geom_point() +
geom_smooth(method= "lm") +
facet_wrap(~metric, nrow= 4, scales= "free_x") +
theme_bw()
ggplot(ani.env, aes(x= diff, y= mean_popANI)) +
geom_point() +
geom_smooth(method= "lm") +
facet_wrap(~metric, nrow= 4, scales= "free_x") +
theme_bw()
ggplot(ani.env, aes(x= diff, y= mean_conANI)) +
geom_point() +
geom_smooth(method= "lm") +
facet_wrap(~metric, nrow= 4, scales= "free_x") +
theme_bw()
ggplot(filter(ani.env, envID1 != envID2), aes(x= diff, y= mean_conANI)) +
geom_point() +
geom_smooth(method= "lm") +
facet_wrap(~metric, nrow= 4, scales= "free_x") +
theme_bw()
## Make plots
source("ggplot_themes.R")
